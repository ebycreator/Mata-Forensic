<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>META FORENSIC</title>

  <!-- TailwindCSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- EXIF Reader -->
  <script src="https://cdn.jsdelivr.net/npm/exifreader@4.12.0/dist/exif-reader.min.js"></script>

  <!-- SHA hashing -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.2.0/crypto-js.min.js"></script>

  <!-- Excel export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.19.3/xlsx.full.min.js"></script>

  <!-- PDF Generator -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <!-- Leaflet Map -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <style>
    /* PREMIUM FORENSIC THEME */
    body {
      background: radial-gradient(circle at top, #0a0f1f 0%, #000 100%);
      color: #e5e7eb;
      font-family: 'Inter', sans-serif;
    }

    .glass-card {
      background: rgba(15, 23, 42, 0.55);
      border: 1px solid rgba(148, 163, 184, 0.15);
      backdrop-filter: blur(12px);
      box-shadow: 0 0 25px rgba(0, 255, 255, 0.08);
      border-radius: 12px;
      padding: 1.2rem;
    }

    .glow-text {
      text-shadow: 0 0 12px rgba(56, 189, 248, 0.6);
    }

    .cyber-divider {
      height: 3px;
      width: 180px;
      background: linear-gradient(90deg, transparent, #38bdf8, #0ea5e9, transparent);
      margin: 12px auto;
      border-radius: 4px;
    }

    #map { height: 220px; border-radius: 12px; margin-top: 10px; }
  </style>
</head>

<body class="p-6">

<!-- HEADER -->
<nav class="navbar py-4 mb-10 text-center">
  <h1 class="text-6xl font-extrabold text-white glow-text tracking-widest">META FORENSIC</h1>
  <div class="cyber-divider"></div>
  <p class="text-lg text-cyan-300 mt-3 opacity-90">Digital Image Metadata • Hashing • Forensic Reporting</p>
</nav>

<div class="max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-2 gap-6">

  <!-- LEFT SIDE -->
  <div>
    <!-- Upload Card -->
    <div class="glass-card mb-6">
      <h2 class="text-xl text-cyan-300 font-bold mb-3">Upload Image</h2>
      <input type="file" id="fileInput" class="bg-slate-800 p-3 rounded text-white w-full">
    </div>

    <!-- Preview -->
    <div class="glass-card mb-6">
      <h2 class="text-xl text-cyan-300 font-bold mb-3">Image Preview</h2>
      <img id="preview" class="rounded-lg shadow-lg border border-cyan-700/40 w-full">
    </div>

    <!-- GPS -->
    <div id="gpsCard" class="glass-card hidden">
      <h2 class="text-xl text-cyan-300 font-bold mb-3">Location (GPS)</h2>
      <div id="gpsText"></div>
      <div id="map"></div>
    </div>
  </div>

  <!-- RIGHT SIDE -->
  <div>
    <div class="glass-card mb-6">
      <h2 class="text-xl text-cyan-300 font-bold mb-3">Metadata Output</h2>
      <pre id="metadata" class="text-sm whitespace-pre-wrap"></pre>
    </div>

    <!-- Buttons -->
    <div class="glass-card flex gap-3">
      <button onclick="downloadExcel()" class="bg-cyan-600 px-4 py-2 rounded hover:bg-cyan-500 font-semibold">Download Excel</button>
      <button onclick="generatePDF()" class="bg-emerald-600 px-4 py-2 rounded hover:bg-emerald-500 font-semibold">Generate PDF Report</button>
    </div>
  </div>

</div>

<script>
/* GLOBAL VARIABLES */
let gpsMap = null;
let lastMetadata = null;
let lastFile = null;

/* FILE SELECT EVENT */
document.getElementById("fileInput").addEventListener("change", async function(e) {
  const file = e.target.files[0];
  if (!file) return;
  lastFile = file;

  // Preview
  document.getElementById("preview").src = URL.createObjectURL(file);

  // Read metadata
  const arrayBuffer = await file.arrayBuffer();
  const tags = ExifReader.load(arrayBuffer);
  lastMetadata = tags;

  // Format and display metadata
  document.getElementById("metadata").textContent = formatMetadata(tags, file);

  // GPS
  showGPS(tags);

});

/* PROFESSIONAL METADATA FORMATTER */
function formatMetadata(tags, file) {
  let out = "";

  out += `--- GENERAL INFO ---
File Name: ${file.name}
File Size: ${(file.size / (1024 * 1024)).toFixed(2)} MB
MIME Type: ${file.type}

`;

  out += `--- HASH VALUES ---
MD5: ${CryptoJS.MD5(lastFile.name).toString()}
SHA-1: ${CryptoJS.SHA1(lastFile.name).toString()}
SHA-256: ${CryptoJS.SHA256(lastFile.name).toString()}

`;

  out += `--- CAMERA DETAILS ---
Make: ${tags?.Make?.description || "N/A"}
Model: ${tags?.Model?.description || "N/A"}
Serial Number: ${tags?.BodySerialNumber?.description || "N/A"}

`;

  out += `--- IMAGE DETAILS ---
Resolution: ${tags?.ExifImageWidth?.value || "?"} x ${tags?.ExifImageHeight?.value || "?"}
Orientation: ${tags?.Orientation?.description || "N/A"}
Color Space: ${tags?.ColorSpace?.description || "N/A"}

`;

  out += `--- DATE & TIME ---
Original Date: ${tags?.DateTimeOriginal?.description || "N/A"}
Modified Date: ${tags?.ModifyDate?.description || "N/A"}

`;

  if (tags.GPSLatitude && tags.GPSLongitude) {
    out += `--- GPS ---
Latitude: ${tags.GPSLatitude.description}
Longitude: ${tags.GPSLongitude.description}
`;
  }

  return out;
}

/* SHOW GPS ON MAP */
function showGPS(tags) {
  if (!tags.GPSLatitude || !tags.GPSLongitude) {
    document.getElementById("gpsCard").classList.add("hidden");
    return;
  }

  const lat = tags.GPSLatitude.description;
  const lon = tags.GPSLongitude.description;

  document.getElementById("gpsText").innerHTML = `Latitude: ${lat}<br>Longitude: ${lon}`;
  document.getElementById("gpsCard").classList.remove("hidden");

  if (!gpsMap) {
    gpsMap = L.map('map').setView([lat, lon], 15);
    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(gpsMap);
  }

  L.marker([lat, lon]).addTo(gpsMap);
}

/* DOWNLOAD EXCEL FILE */
function downloadExcel() {
  const meta = document.getElementById("metadata").textContent;
  const sheet = XLSX.utils.aoa_to_sheet(meta.split("\n").map(line => [line]));
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, sheet, "Metadata");
  XLSX.writeFile(wb, "metadata.xlsx");
}

/* PDF FORENSIC REPORT */
function generatePDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  doc.setFont("courier", "normal");

  doc.text("META FORENSIC REPORT", 10, 10);
  doc.text(document.getElementById("metadata").textContent, 10, 20);

  doc.save("forensic_report.pdf");
}
</script>

</body>
</html>
