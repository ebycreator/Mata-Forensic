<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>META FORENSIC – Digital Image Metadata Analyzer</title>

<!-- Tailwind CSS -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- Leaflet Map -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<!-- EXIF Reader -->
<script src="https://cdn.jsdelivr.net/npm/exifreader@4.12.0/dist/exif-reader.min.js"></script>

<!-- SheetJS - EXCEL Export -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<!-- jsPDF - PDF Forensics Report -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<!-- Crypto API (Hash Calculation) built in browser -->
<style>
body {
  background: #0a0f1c;
  color: white;
  font-family: 'Segoe UI', sans-serif;
}

.glow-title {
  text-shadow: 0 0 12px #0ff, 0 0 20px #0ff;
}

.card {
  background: rgba(0,0,0,0.45);
  backdrop-filter: blur(6px);
  border: 1px solid #0ff3;
  border-radius: 12px;
  padding: 20px;
}
</style>
</head>
<body class="p-6">

<!-- HEADER -->
<header class="text-center mb-10">
  <h1 class="text-5xl font-extrabold glow-title text-cyan-400 tracking-wide">
    META FORENSIC
  </h1>
  <p class="text-lg text-gray-300 mt-2">
    Digital Image Metadata • Hashing • Deepfake Detection • Chain-of-Custody • Report Generator
  </p>
</header>

<!-- Upload Section -->
<div class="card max-w-3xl mx-auto mb-8">
  <h2 class="text-2xl mb-4 font-bold text-cyan-300">Upload Image</h2>
  <input id="imageInput" type="file" accept="image/*" class="w-full p-3 rounded bg-gray-900 border border-cyan-500" />
</div>

<!-- Metadata Output -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">

  <div class="card">
    <h2 class="text-2xl mb-3 font-bold text-cyan-300">Extracted Metadata</h2>
    <pre id="metadata" class="text-sm whitespace-pre-wrap"></pre>
  </div>

  <div class="card">
    <h2 class="text-2xl mb-3 font-bold text-cyan-300">Hash Values</h2>
    <pre id="hashOutput" class="text-sm whitespace-pre-wrap"></pre>
  </div>

</div>

<!-- Camera Info -->
<div class="card mt-8">
  <h2 class="text-2xl mb-3 font-bold text-cyan-300">Camera Information</h2>
  <pre id="cameraInfo" class="text-sm whitespace-pre-wrap"></pre>
</div>

<!-- Date/Time -->
<div class="card mt-8">
  <h2 class="text-2xl mb-3 font-bold text-cyan-300">Date & Time</h2>
  <pre id="dateInfo" class="text-sm whitespace-pre-wrap"></pre>
</div>

<!-- GPS MAP -->
<div class="card mt-8">
  <h2 class="text-2xl mb-3 font-bold text-cyan-300">GPS Location</h2>
  <div id="map" style="height: 300px; border-radius: 12px;"></div>
</div>

<!-- Deepfake / Manipulation -->
<div class="card mt-8">
  <h2 class="text-2xl mb-4 font-bold text-red-400">AI Deepfake / Manipulation Scan</h2>
  <p class="text-gray-300 mb-2">This is a placeholder. Connect to your ML backend.</p>
  <button onclick="runDeepfakeScan()" class="px-4 py-2 bg-red-600 rounded hover:bg-red-700">Run Scan</button>
  <pre id="deepfakeResult" class="mt-3 text-sm whitespace-pre-wrap"></pre>
</div>

<!-- Chain of Custody -->
<div class="card mt-8">
  <h2 class="text-2xl mb-4 font-bold text-yellow-300">Chain of Custody Log</h2>
  <pre id="chainCustody" class="text-sm whitespace-pre-wrap"></pre>
</div>

<!-- Export Buttons -->
<div class="flex justify-center gap-6 mt-10">
  <button onclick="downloadExcel()" class="px-5 py-3 bg-cyan-600 rounded hover:bg-cyan-700">Download Excel</button>
  <button onclick="downloadPDF()" class="px-5 py-3 bg-green-600 rounded hover:bg-green-700">Download PDF Report</button>
</div>

<script>
// ================================
// IMAGE UPLOAD HANDLER
// ================================
document.getElementById("imageInput").addEventListener("change", async function(event) {
  const file = event.target.files[0];
  if (!file) return;

  // METADATA
  const arrayBuffer = await file.arrayBuffer();
  const tags = ExifReader.load(arrayBuffer);
  document.getElementById("metadata").textContent = JSON.stringify(tags, null, 2);

  // CAMERA INFO
  const camera = `
Camera Make: ${tags?.Make?.description || "N/A"}
Camera Model: ${tags?.Model?.description || "N/A"}
Serial Number: ${tags?.BodySerialNumber?.description || "Not Available"}
Lens: ${tags?.LensModel?.description || "N/A"}
  `;
  document.getElementById("cameraInfo").textContent = camera;

  // DATE INFO
  const dateInfo = `
Original Date: ${tags?.DateTimeOriginal?.description || "N/A"}
Modified Date: ${tags?.ModifyDate?.description || "N/A"}
  `;
  document.getElementById("dateInfo").textContent = dateInfo;

  // HASHING
  const md5 = await digestMessage(file, "MD5");
  const sha1 = await digestMessage(file, "SHA-1");
  const sha256 = await digestMessage(file, "SHA-256");

  document.getElementById("hashOutput").textContent = `
MD5: ${md5}
SHA-1: ${sha1}
SHA-256: ${sha256}
  `;

  // GPS MAP
  const gps = extractGps(tags);
  if (gps) loadMap(gps.lat, gps.lng);

  // Chain of Custody
  document.getElementById("chainCustody").textContent = `
Evidence Name: ${file.name}
Imported By: Investigator
Import Date: ${new Date().toLocaleString()}
Hash (SHA-256): ${sha256}
Status: Stored
  `;
});

// ================================
// HASH FUNCTION
// ================================
async function digestMessage(file, algorithm) {
  const buffer = await file.arrayBuffer();
  const hash = await crypto.subtle.digest(algorithm, buffer);
  return Array.from(new Uint8Array(hash)).map(b => b.toString(16).padStart(2, "0")).join("");
}

// ================================
// GPS EXTRACTOR
// ================================
function extractGps(tags) {
  try {
    const lat = tags.GPSLatitude.description;
    const lng = tags.GPSLongitude.description;
    return { lat, lng };
  } catch { return null; }
}

// ================================
// MAP LOADER
// ================================
let map;
function loadMap(lat, lng) {
  if (!map) {
    map = L.map("map").setView([lat, lng], 15);
    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);
  }
  L.marker([lat, lng]).addTo(map);
}

// ================================
// DEEPFAKE PLACEHOLDER
// ================================
function runDeepfakeScan() {
  document.getElementById("deepfakeResult").textContent =
    "⚠ System: Deepfake Detection Backend Not Connected.\nUse Python ML API to integrate.";
}

// ================================
// EXCEL EXPORT
// ================================
function downloadExcel() {
  const data = [{ Metadata: document.getElementById("metadata").textContent }];
  const ws = XLSX.utils.json_to_sheet(data);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Metadata");
  XLSX.writeFile(wb, "Metadata_Forensic_Report.xlsx");
}

// ================================
// PDF EXPORT
// ================================
function downloadPDF() {
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF();
  pdf.text("META FORENSIC - PDF Report", 20, 20);
  pdf.text("Metadata:", 20, 40);
  pdf.text(document.getElementById("metadata").textContent, 20, 50);
  pdf.save("Forensic_Report.pdf");
}
</script>

</body>
</html>
