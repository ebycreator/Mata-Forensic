<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>META FORENSIC — Cyber Dark</title>

  <!-- Tailwind for utility classes (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- ExifReader (fixed working CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/exifreader@4.12.0/dist/exif-reader.min.js"></script>

  <!-- Leaflet for maps -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- CryptoJS for MD5 -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>

  <!-- SheetJS for Excel export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

  <!-- jsPDF + html2canvas for PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

  <style>
    /* Cyber dark forensic theme */
    :root{
      --bg: #06070a;
      --panel: rgba(10,12,16,0.85);
      --card: rgba(7,10,18,0.9);
      --neon: #00bfff;
      --muted: #8b98a6;
      --glass: rgba(255,255,255,0.02);
    }
    html,body{height:100%; background: linear-gradient(180deg,#02040a 0%, #071226 60%), url('https://images.unsplash.com/photo-1542838132-92c53300491e?auto=format&fit=crop&w=1920&q=60') center/cover fixed no-repeat; color:#e6eef6; font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;}
    .app {
      max-width:1100px;
      margin:28px auto;
      padding:20px;
      display:grid;
      grid-template-columns: 1fr;
      gap:16px;
    }
    header.app-header{
      display:flex; align-items:center; gap:14px; justify-content:space-between;
      background: linear-gradient(90deg, rgba(0,0,0,0.45), rgba(8,10,20,0.55));
      border-radius:12px; padding:14px 18px; box-shadow: 0 8px 30px rgba(0,0,0,0.6);
    }
    header h1{ font-size:1.5rem; letter-spacing:0.6px; color:var(--neon); text-shadow:0 2px 12px rgba(0,191,255,0.08); margin:0;}
    header p { margin:0; color:var(--muted); font-size:0.95rem; }

    .panel {
      background: var(--panel);
      border-radius:10px;
      padding:14px;
      box-shadow: 0 10px 30px rgba(2,6,23,0.6), inset 0 1px 0 rgba(255,255,255,0.02);
      border: 1px solid rgba(0,191,255,0.06);
    }

    .grid-2{ display:grid; grid-template-columns: 1fr 420px; gap:18px; }
    @media (max-width: 980px){ .grid-2{ grid-template-columns: 1fr; } }

    /* Drop zone */
    .dropzone {
      border: 1px dashed rgba(0,191,255,0.18);
      padding:18px;
      border-radius:10px;
      background: linear-gradient(180deg, rgba(255,255,255,0.01), transparent);
      transition: all .15s ease;
      cursor: pointer;
      text-align:center;
    }
    .dropzone:hover{ transform: translateY(-2px); box-shadow: 0 10px 30px rgba(0,191,255,0.03); }
    .dropzone.drag { background: linear-gradient(90deg, rgba(0,191,255,0.02), rgba(0,191,255,0.01)); border-color: rgba(0,191,255,0.35); }

    /* Preview */
    #preview { width:100%; max-width:360px; border-radius:8px; border:1px solid rgba(255,255,255,0.04); background:var(--glass); }

    /* Metadata area */
    .metadata-grid{
      display:grid;
      grid-template-columns: repeat(2,minmax(0,1fr));
      gap:10px;
      margin-top:12px;
    }
    .metadata-card{
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:8px;
      padding:10px 12px;
      border:1px solid rgba(0,191,255,0.04);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:8px;
      min-height:44px;
    }
    .metadata-key{ color:#cfeefd; font-weight:700; font-size:0.9rem; }
    .metadata-value{ color:#dbeefe; text-align:right; font-size:0.9rem; word-break:break-word; max-width: 260px; }

    /* Badges / hash */
    .hash-row{ display:flex; gap:8px; flex-wrap:wrap; margin-top:10px; }
    .hash-badge{ background: rgba(0,191,255,0.06); padding:8px 10px; border-radius:8px; border:1px solid rgba(0,191,255,0.06); color:var(--neon); font-weight:600; font-size:0.85rem; }

    /* Controls */
    .controls{ display:flex; gap:8px; flex-wrap:wrap; margin-top:10px; }
    .btn { padding:8px 12px; border-radius:8px; border:none; cursor:pointer; font-weight:700; color:#051122; }
    .btn-primary{ background: linear-gradient(90deg,var(--neon), #58d6ff); box-shadow:0 6px 18px rgba(0,191,255,0.08); }
    .btn-ghost{ background:transparent; border:1px solid rgba(255,255,255,0.04); color:var(--neon); font-weight:600; }

    /* small muted */
    .muted { color: var(--muted); font-size:0.9rem; }

    /* card header */
    .card-title{ font-weight:800; color:#bfefff; display:flex; align-items:center; gap:8px; font-size:1rem; }

    /* map card */
    #map{ height:220px; border-radius:8px; overflow:hidden; border:1px solid rgba(255,255,255,0.02); }

    /* footer */
    footer{ text-align:center; color:var(--muted); margin-top:6px; font-size:0.9rem; }
  </style>
</head>
<body>
  <div class="app">
    <header class="app-header panel">
      <div>
        <h1>META FORENSIC</h1>
        <p class="muted">Digital forensic image metadata & triage — Cyber Dark theme</p>
      </div>
      <div class="muted">Ready • <span id="status">idle</span></div>
    </header>

    <div class="panel grid-2">
      <!-- Left: uploader & preview & controls -->
      <div>
        <div id="drop" class="dropzone" title="Drag & drop image or click to choose">
          <input id="fileInput" type="file" accept="image/*" class="hidden" />
          <div>
            <div style="font-weight:800; color:var(--neon); font-size:1.1rem;">Drop image / Click to upload</div>
            <div class="muted" style="margin-top:6px;">JPEG (EXIF preferred). PNG, HEIC (browser dependent).</div>
            <div style="margin-top:10px;">
              <button id="chooseBtn" class="btn btn-primary">Choose File</button>
            </div>
          </div>
        </div>

        <div id="previewWrap" class="panel" style="margin-top:14px; display:none;">
          <div style="display:flex; gap:12px; align-items:flex-start;">
            <img id="preview" alt="preview" />
            <div style="flex:1;">
              <div class="card-title">Image Preview & General Info</div>
              <div id="basicInfo" class="muted" style="margin-top:6px;">—</div>

              <div class="hash-row" id="hashRow" aria-hidden="false" style="margin-top:12px;">
                <div class="hash-badge">MD5: <span id="md5Val" style="margin-left:8px; color:#dff8ff; font-weight:700;">—</span></div>
                <div class="hash-badge">SHA-1: <span id="sha1Val" style="margin-left:8px; color:#dff8ff; font-weight:700;">—</span></div>
                <div class="hash-badge">SHA-256: <span id="sha256Val" style="margin-left:8px; color:#dff8ff; font-weight:700;">—</span></div>
              </div>

              <div class="controls" style="margin-top:12px;">
                <button id="downloadMetaBtn" class="btn btn-ghost">Download JSON</button>
                <button id="downloadExcelBtn" class="btn btn-ghost">Download Excel</button>
                <button id="generatePdfBtn" class="btn btn-primary">Generate PDF Report</button>
              </div>
            </div>
          </div>
        </div>

        <div id="manipNotes" class="muted" style="margin-top:10px;">Heuristic notes will appear here after analysis.</div>
      </div>

      <!-- Right: metadata & map -->
      <div>
        <div class="card-title">Metadata</div>
        <div id="rawJsonWrap" class="panel" style="margin-top:10px; display:none;">
          <div id="metaTop" style="display:flex; gap:12px; justify-content:space-between; align-items:center;">
            <div class="muted">Flattened metadata (click to copy values)</div>
            <div>
              <button id="copyMetaBtn" class="btn btn-ghost">Copy Metadata</button>
            </div>
          </div>

          <div id="metaGrid" class="metadata-grid" style="margin-top:12px;"></div>
        </div>

        <div id="gpsWrap" class="panel" style="margin-top:12px; display:none;">
          <div class="card-title">GPS & Map</div>
          <div id="gpsText" class="muted" style="margin-top:8px;">—</div>
          <a id="gpsLink" class="muted" target="_blank" rel="noopener" style="display:inline-block; margin-top:6px; text-decoration:underline;">Open in Google Maps</a>
          <div id="map" style="margin-top:10px;"></div>
        </div>
      </div>
    </div>

    <footer class="muted">© Meta Forensic — Cyber Dark • Local browser-only analysis</footer>
  </div>

  <script>
  // ======= Globals =======
  const drop = document.getElementById('drop');
  const fileInput = document.getElementById('fileInput');
  const chooseBtn = document.getElementById('chooseBtn');
  const preview = document.getElementById('preview');
  const previewWrap = document.getElementById('previewWrap');
  const rawJsonWrap = document.getElementById('rawJsonWrap');
  const metaGrid = document.getElementById('metaGrid');
  const gpsWrap = document.getElementById('gpsWrap');
  const gpsText = document.getElementById('gpsText');
  const gpsLink = document.getElementById('gpsLink');
  const md5Val = document.getElementById('md5Val');
  const sha1Val = document.getElementById('sha1Val');
  const sha256Val = document.getElementById('sha256Val');
  const basicInfo = document.getElementById('basicInfo');
  const statusEl = document.getElementById('status');
  const downloadMetaBtn = document.getElementById('downloadMetaBtn');
  const downloadExcelBtn = document.getElementById('downloadExcelBtn');
  const generatePdfBtn = document.getElementById('generatePdfBtn');
  const copyMetaBtn = document.getElementById('copyMetaBtn');
  const manipNotes = document.getElementById('manipNotes');

  let currentFile = null;
  let currentMetadata = {};
  let map = null;
  let mapMarker = null;

  // ======= Helpers =======
  function setStatus(s){ statusEl.textContent = s; }
  function readAsArrayBuffer(file){ return file.arrayBuffer(); }
  function readAsDataURL(file){
    return new Promise((res,rej)=>{
      const r=new FileReader();
      r.onload = ()=>res(r.result);
      r.onerror = rej;
      r.readAsDataURL(file);
    });
  }

  // MD5 via CryptoJS
  function computeMD5FromArrayBuffer(arrayBuffer){
    try{
      const wordArray = CryptoJS.lib.WordArray.create(arrayBuffer);
      return CryptoJS.MD5(wordArray).toString(CryptoJS.enc.Hex);
    }catch(e){ console.warn('MD5 error', e); return 'md5_err'; }
  }
  // SHA1/SHA256 via SubtleCrypto
  async function computeSubtleHash(arrayBuffer, algo){
    try{
      const digest = await crypto.subtle.digest(algo, arrayBuffer);
      return Array.from(new Uint8Array(digest)).map(b=>b.toString(16).padStart(2,'0')).join('');
    }catch(e){
      console.warn('Subtle hash error', e);
      return algo+'_err';
    }
  }

  // Flatten and format ExifReader tags
  function normalizeTags(tags){
    const out = {};
    for(const k in tags){
      if(!Object.prototype.hasOwnProperty.call(tags,k)) continue;
      const v = tags[k];
      // ExifReader entries can have .description, .value (or be primitive)
      if(v && typeof v === 'object'){
        out[k] = (v.description !== undefined) ? v.description : (v.value !== undefined ? v.value : v);
      } else {
        out[k] = v;
      }
    }

    // Camera model / serial
    out['Camera Model'] = out['Model'] || out['CameraModel'] || out['Make'] || out['Model'] || out['Image Model'] || out['ModelName'] || out['ModelID'] || out['Model'];
    out['Camera Serial Number'] = out['BodySerialNumber'] || out['SerialNumber'] || out['CameraSerialNumber'] || out['OwnerID'] || out['BodySerialNumber'] || out['Serial No.'] || out['Serial'];

    // Dates
    out['Original Date & Time'] = out['DateTimeOriginal'] || out['CreateDate'] || out['Date Created'] || out['DateTime'];
    out['Modified Date & Time'] = out['ModifyDate'] || out['DateTimeDigitized'] || out['LastModifiedDate'] || out['Date Time'] || out['Modify Date'] || out['ModifyDate'];

    // GPS -> decimal if present
    try{
      if(tags.GPSLatitude && tags.GPSLongitude){
        const lat = toDecimal(tags.GPSLatitude.value || tags.GPSLatitude);
        const lon = toDecimal(tags.GPSLongitude.value || tags.GPSLongitude);
        const latRef = (tags.GPSLatitudeRef && (tags.GPSLatitudeRef.description || tags.GPSLatitudeRef.value)) || '';
        const lonRef = (tags.GPSLongitudeRef && (tags.GPSLongitudeRef.description || tags.GPSLongitudeRef.value)) || '';
        out['_latitude'] = (latRef === 'S') ? -Math.abs(lat) : lat;
        out['_longitude'] = (lonRef === 'W') ? -Math.abs(lon) : lon;
      }
    }catch(e){}
    return out;
  }

  function toDecimal(input){
    if(input === undefined || input === null) return null;
    if(typeof input === 'number') return input;
    if(Array.isArray(input)){
      const [d,m,s] = input.map(Number);
      return d + (m||0)/60 + (s||0)/3600;
    }
    if(typeof input === 'string'){
      const parts = input.split(',').map(p=>p.trim());
      const nums = parts.map(p=>{
        const frac = p.split('/');
        return frac.length===2 ? Number(frac[0])/Number(frac[1]) : Number(p);
      });
      return nums[0] + (nums[1]||0)/60 + (nums[2]||0)/3600;
    }
    const n = Number(input); return isNaN(n)?null:n;
  }

  // Render metadata cards (professional layout)
  function renderMetadataCards(metadata){
    metaGrid.innerHTML = '';
    rawJsonWrap.style.display = 'block';

    // Preferred ordering for important forensic fields
    const preferred = ['Camera Model','Camera Serial Number','Original Date & Time','Modified Date & Time','File Type','Image Width','Image Height','Exif Image Width','Exif Image Height','FNumber','ExposureTime','ISOSpeedRatings','FocalLength','Software','Make','Model','_latitude','_longitude'];
    // build keys but ensure uniqueness
    const keys = Object.keys(metadata).filter(k => metadata[k] !== undefined && metadata[k] !== null);
    keys.sort((a,b)=>{
      const ai = preferred.indexOf(a), bi = preferred.indexOf(b);
      if(ai === -1 && bi === -1) return a.localeCompare(b);
      if(ai === -1) return 1;
      if(bi === -1) return -1;
      return ai - bi;
    });

    // Render two-column cards
    for(const key of keys){
      const val = metadata[key];
      // skip internal keys if empty
      const card = document.createElement('div');
      card.className = 'metadata-card';
      const kEl = document.createElement('div'); kEl.className = 'metadata-key'; kEl.textContent = key;
      const vEl = document.createElement('div'); vEl.className = 'metadata-value';
      // format arrays/objects nicely
      let text;
      if(Array.isArray(val)) text = val.join(', ');
      else if(typeof val === 'object') text = JSON.stringify(val);
      else text = String(val);
      vEl.textContent = text;
      // allow clicking a value to copy
      vEl.style.cursor = 'pointer';
      vEl.title = 'Click to copy';
      vEl.addEventListener('click', ()=> {
        navigator.clipboard.writeText(text).then(()=> {
          vEl.style.transition = 'all .12s'; vEl.style.transform = 'translateY(-3px)'; setTimeout(()=> vEl.style.transform='none',180);
        }).catch(()=>{});
      });
      card.appendChild(kEl); card.appendChild(vEl);
      metaGrid.appendChild(card);
    }
    // Also set hidden textual metadata for exports
    let metaTextEl = document.getElementById('metadataTextForExport');
    if(!metaTextEl){
      metaTextEl = document.createElement('pre'); metaTextEl.id = 'metadataTextForExport'; metaTextEl.style.display = 'none';
      document.body.appendChild(metaTextEl);
    }
    metaTextEl.textContent = keys.map(k => `${k}: ${ (Array.isArray(metadata[k])? metadata[k].join(', ') : (typeof metadata[k] === 'object' ? JSON.stringify(metadata[k]) : String(metadata[k])) ) }`).join('\n');
  }

  // ======= Map =======
  function showMap(lat,lon){
    gpsWrap.style.display = 'block';
    gpsText.textContent = `Latitude: ${lat.toFixed(6)}, Longitude: ${lon.toFixed(6)}`;
    gpsLink.href = `https://www.google.com/maps?q=${lat},${lon}`;
    if(!map){
      map = L.map('map', { zoomControl: true, attributionControl: false }).setView([lat,lon], 14);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
      mapMarker = L.marker([lat,lon]).addTo(map);
    } else {
      map.setView([lat,lon], 14);
      if(mapMarker) mapMarker.setLatLng([lat,lon]);
      else mapMarker = L.marker([lat,lon]).addTo(map);
    }
  }

  // ======= Export helpers =======
  downloadMetaBtn.addEventListener('click', ()=>{
    if(!currentFile || !currentMetadata) return alert('Analyze a file first.');
    const payload = {
      fileName: currentFile.name,
      fileSize: currentFile.size,
      metadata: currentMetadata,
      generated: new Date().toISOString()
    };
    const blob = new Blob([JSON.stringify(payload, null, 2)], { type: 'application/json' });
    const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = `${currentFile.name.replace(/\.[^/.]+$/,'')}_metadata.json`; a.click(); URL.revokeObjectURL(a.href);
  });

  copyMetaBtn.addEventListener('click', ()=>{
    if(!currentMetadata) return;
    navigator.clipboard.writeText(JSON.stringify(currentMetadata, null, 2));
    alert('Metadata copied to clipboard');
  });

  downloadExcelBtn.addEventListener('click', ()=>{
    if(!currentFile || !currentMetadata) return alert('Analyze a file first.');
    const metaText = document.getElementById('metadataTextForExport') ? document.getElementById('metadataTextForExport').textContent : '';
    const rows = metaText.split('\n').map(r => [r]);
    const ws = XLSX.utils.aoa_to_sheet(rows);
    const wb = XLSX.utils.book_new(); XLSX.utils.book_append_sheet(wb, ws, 'Metadata');
    const fname = `${currentFile.name.replace(/\.[^/.]+$/,'')}_metadata.xlsx`;
    XLSX.writeFile(wb, fname);
  });

  generatePdfBtn.addEventListener('click', async ()=>{
    if(!currentFile || !currentMetadata) return alert('Analyze a file first.');
    // build report node
    const report = document.createElement('div');
    report.style.width = '900px';
    report.style.padding = '18px';
    report.style.background = '#fff';
    report.style.color = '#000';
    report.innerHTML = `<h1 style="font-size:18px;margin:0 0 8px 0">META FORENSIC — Forensic Report</h1>
      <div style="font-size:12px;margin-bottom:8px;">
        <strong>File:</strong> ${currentFile.name} &nbsp; | &nbsp; <strong>Generated:</strong> ${new Date().toLocaleString()}
      </div>
      <div style="display:flex;gap:12px;">
        <div style="flex:1;"><img src="${preview.src}" style="max-width:100%; border:1px solid #ccc;"></div>
        <div style="flex:1;">
          <h3 style="margin:0 0 6px 0">Key Metadata</h3>
          <pre style="white-space:pre-wrap; font-size:11px; background:#f7f7f7; padding:8px; border-radius:6px;">${document.getElementById('metadataTextForExport') ? document.getElementById('metadataTextForExport').textContent : ''}</pre>
        </div>
      </div>
      <div style="margin-top:10px;">
        <h3 style="margin:0 0 6px 0">Heuristic Notes</h3>
        <div style="font-size:12px;">${manipNotes.textContent || '(none)'}</div>
      </div>
    `;
    document.body.appendChild(report);
    const canvas = await html2canvas(report, { scale: 2 });
    const imgData = canvas.toDataURL('image/jpeg', 0.9);
    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF({ unit:'px', format:[canvas.width, canvas.height] });
    pdf.addImage(imgData, 'JPEG', 0, 0, canvas.width, canvas.height);
    pdf.save(`${currentFile.name.replace(/\.[^/.]+$/,'')}_forensic_report.pdf`);
    document.body.removeChild(report);
  });

  // ======= Main analysis flow =======
  chooseBtn.addEventListener('click', ()=> fileInput.click());
  fileInput.addEventListener('change', (e)=> { const f = e.target.files && e.target.files[0]; if(f) handleFile(f); });

  ['dragenter','dragover'].forEach(ev => drop.addEventListener(ev, (e)=>{ e.preventDefault(); drop.classList.add('drag'); }));
  ['dragleave','drop'].forEach(ev => drop.addEventListener(ev, (e)=>{ e.preventDefault(); drop.classList.remove('drag'); }));
  drop.addEventListener('drop', (e)=>{ e.preventDefault(); const f = e.dataTransfer.files && e.dataTransfer.files[0]; if(f) handleFile(f); });

  async function handleFile(file){
    try{
      setStatus('processing');
      currentFile = file;
      const arrayBuffer = await readAsArrayBuffer(file);
      const dataURL = await readAsDataURL(file);
      preview.src = dataURL;
      previewWrap.style.display = 'block';

      // read EXIF via ExifReader (expanded gives richer objects)
      let tags = {};
      try{
        tags = ExifReader.load(arrayBuffer, { expanded: true });
      }catch(e){
        console.warn('ExifReader load error', e);
        try{ tags = ExifReader.load(arrayBuffer); } catch(e2){ tags = {}; }
      }
      const normalized = normalizeTags(tags);
      currentMetadata = normalized;

      // compute hashes
      const md5 = computeMD5FromArrayBuffer(arrayBuffer);
      const sha1 = await computeSubtleHash(arrayBuffer, 'SHA-1');
      const sha256 = await computeSubtleHash(arrayBuffer, 'SHA-256');
      md5Val.textContent = md5;
      sha1Val.textContent = sha1;
      sha256Val.textContent = sha256;

      // attach hashes to metadata
      currentMetadata['MD5'] = md5;
      currentMetadata['SHA-1'] = sha1;
      currentMetadata['SHA-256'] = sha256;

      // update UI info
      basicInfo.textContent = `Type: ${file.type || 'N/A'} • Size: ${(file.size/1024).toFixed(1)} KB • Modified: ${new Date(file.lastModified).toLocaleString()}`;
      manipNotes.textContent = computeHeuristics(tags, currentMetadata);

      // render metadata cards
      renderMetadataCards(currentMetadata);

      // if GPS present, show map
      if(currentMetadata._latitude && currentMetadata._longitude){
        showMap(currentMetadata._latitude, currentMetadata._longitude);
      } else {
        gpsWrap.style.display = 'none';
      }

      setStatus('ready');
    }catch(err){
      console.error(err);
      setStatus('error');
      alert('Analysis failed: ' + (err && err.message ? err.message : String(err)));
    }
  }

  // Simple heuristics (date consistency, presence of software tag, thumbnail)
  function computeHeuristics(tags, metadata){
    const notes = [];
    try{
      const sw = tags.Software || tags.ProcessingSoftware || tags.CreatorTool;
      if(sw) notes.push('Software/Processing tag present — inspect application listed.');
      else notes.push('No software/processing tag found (may be stripped).');

      const orig = (tags.DateTimeOriginal && (tags.DateTimeOriginal.description || tags.DateTimeOriginal.value)) || metadata['Original Date & Time'];
      const mod = (tags.ModifyDate && (tags.ModifyDate.description || tags.ModifyDate.value)) || metadata['Modified Date & Time'];
      if(orig && mod){
        const o = Date.parse(String(orig).replace(/:/g,'-'));
        const m = Date.parse(String(mod).replace(/:/g,'-'));
        if(!isNaN(o) && !isNaN(m) && m > o + 60000) notes.push('ModifyDate later than DateTimeOriginal — possible edit after capture.');
      }
      const thumb = !!(tags.JPEGThumbnail || tags.Thumbnail);
      if(!thumb) notes.push('No embedded thumbnail (may indicate stripping).');
      notes.push(`SHA-256: ${metadata['SHA-256'] || 'N/A'}`);
    }catch(e){}
    return notes.join(' ');
  }

  // Boot
  setStatus('idle');
  </script>
</body>
</html>
